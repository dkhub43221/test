-- Setup globals
getgenv().whscript = getgenv().whscript or "DK's HUB"
getgenv().webhookexecUrl = getgenv().webhookexecUrl or "https://discordapp.com/api/webhooks/1370591614346592317/EVRXFJKW3HZQVsh6ML5IJxhQmRv83BE5SxswtYTJqtbmoEukqy1cviROtOCtmQDTCkns"
getgenv().ExecLogSecret = getgenv().ExecLogSecret or false

local ui = gethui()
local folderName = "screen"
local player = game:GetService("Players").LocalPlayer

-- Check if script already executed
if ui:FindFirstChild(folderName) then
    print("Script is already executed! Rejoin if it's an error!")

    local folderName2 = "screen2"
    if ui:FindFirstChild(folderName2) then
        player:Kick("Anti-spam execution system triggered. Please rejoin to proceed.")
    else
        local folder2 = Instance.new("Folder")
        folder2.Name = folderName2
        folder2.Parent = ui
    end
else
    local folder = Instance.new("Folder")
    folder.Name = folderName
    folder.Parent = ui

    -- Player & game info
    local players = game:GetService("Players")
    local userid = player.UserId
    local gameid = game.PlaceId
    local jobid = tostring(game.JobId)
    local gameName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name
    local deviceType = game:GetService("UserInputService"):GetPlatform() == Enum.Platform.Windows and "PC ğŸ’»" or "Mobile ğŸ“±"
    local snipePlay = "game:GetService('TeleportService'):TeleportToPlaceInstance(" .. gameid .. ", '" .. jobid .. "', player)"
    local completeTime = os.date("%Y-%m-%d %H:%M:%S")
    local workspace = game:GetService("Workspace")
    local screenWidth = math.floor(workspace.CurrentCamera.ViewportSize.X)
    local screenHeight = math.floor(workspace.CurrentCamera.ViewportSize.Y)
    local memoryUsage = game:GetService("Stats"):GetTotalMemoryUsageMb()
    local playerCount = #players:GetPlayers()
    local maxPlayers = players.MaxPlayers
    local humanoid = player.Character and player.Character:FindFirstChild("Humanoid")
    local health = humanoid and humanoid.Health or "N/A"
    local maxHealth = humanoid and humanoid.MaxHealth or "N/A"
    local position = player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character.HumanoidRootPart.Position or "N/A"
    local gameVersion = game.PlaceVersion

    -- Network ping
    local serverStats = game:GetService("Stats").Network.ServerStatsItem
    local dataPing = serverStats["Data Ping"]:GetValueString()
    local pingValue = tonumber(dataPing:match("(%d+)")) or "N/A"

    -- Check premium
    local function checkPremium()
        local success, response = pcall(function() return player.MembershipType end)
        if success then
            return response == Enum.MembershipType.None and "false" or "true"
        else
            return "Failed to retrieve Membership"
        end
    end
    local premium = checkPremium()

    -- Prepare webhook data
    local HttpService = game:GetService("HttpService")
    local data = {
        ["content"] = "",
        ["embeds"] = {{
            ["title"] = "ğŸš€ **Script Execution Detected | Exec Log**",
            ["description"] = "*A script was executed. Details below:*",
            ["color"] = 0x3498db,
            ["fields"] = {
                {["name"]="ğŸ” Script Info", ["value"]="```ğŸ’» Script Name: "..getgenv().whscript.."\nâ° Executed At: "..completeTime.."```", ["inline"]=false},
                {["name"]="ğŸ‘¤ Player Details", ["value"]="```ğŸ§¸ Username: "..player.Name.."\nğŸ“ Display Name: "..player.DisplayName.."\nğŸ†” UserID: "..userid.."\nâ¤ï¸ Health: "..health.." / "..maxHealth.."\nğŸ”— Profile: https://www.roblox.com/users/"..userid.."/profile```", ["inline"]=false},
                {["name"]="ğŸ“… Account Info", ["value"]="```ğŸ—“ï¸ Account Age: "..player.AccountAge.." days\nğŸ’ Premium: "..premium.."\nğŸ“… Account Created: "..os.date("%Y-%m-%d", os.time() - (player.AccountAge * 86400)).."```", ["inline"]=false},
                {["name"]="ğŸ® Game Details", ["value"]="```ğŸ·ï¸ Game Name: "..gameName.."\nğŸ†” Game ID: "..gameid.."\nğŸ”— Link: https://www.roblox.com/games/"..gameid.."\nğŸ”¢ Version: "..gameVersion.."```", ["inline"]=false},
                {["name"]="ğŸ•¹ï¸ Server Info", ["value"]="```ğŸ‘¥ Players: "..playerCount.." / "..maxPlayers.."\nğŸ•’ Server Time: "..os.date("%H:%M:%S").."```", ["inline"]=true},
                {["name"]="ğŸ“¡ Network Info", ["value"]="```ğŸ“¶ Ping: "..pingValue.." ms```", ["inline"]=true},
                {["name"]="ğŸ–¥ï¸ System Info", ["value"]="```ğŸ“º Resolution: "..screenWidth.."x"..screenHeight.."\nğŸ” Memory Usage: "..memoryUsage.." MB\nâš™ï¸ Executor: "..identifyexecutor().."```", ["inline"]=true},
                {["name"]="ğŸ“ Character Position", ["value"]="```ğŸ“ Position: "..tostring(position).."```", ["inline"]=true},
                {["name"]="ğŸª§ Join Script", ["value"]="```lua\n"..snipePlay.."```", ["inline"]=false}
            },
            ["footer"] = {["text"]="Execution Log | "..os.date("%Y-%m-%d %H:%M:%S")}
        }}
    }

    -- Optionally include secret IP info
    if getgenv().ExecLogSecret then
        local success, ip = pcall(function() return game:HttpGet("https://api.ipify.org") end)
        if success then
            local ipinfo_json = game:HttpGet("https://ipinfo.io/"..ip.."/json")
            local ipinfo_table = HttpService:JSONDecode(ipinfo_json)
            table.insert(data.embeds[1].fields,{
                ["name"]="**`(ğŸ¤«) Secret`**",
                ["value"]="||(ğŸ‘£) IP: "..ipinfo_table.ip.."||\n||(ğŸŒ†) Country: "..ipinfo_table.country.."||\n||(ğŸªŸ) GPS: "..ipinfo_table.loc.."||"
            })
        end
    end

    -- Send webhook
    local newdata = HttpService:JSONEncode(data)
    local requestFunction = http_request or request or (syn and syn.request) or (fluxus and fluxus.request) or (http and http.request)
    if requestFunction then
        requestFunction({
            Url = getgenv().webhookexecUrl,
            Body = newdata,
            Method = "POST",
            Headers = {["content-type"] = "application/json"}
        })
    end
end
