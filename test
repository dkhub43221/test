local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Streetz War Quick Buy",
    LoadingTitle = "Quick Buy",
    LoadingSubtitle = "By You",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "QuickBuyConfig",
        FileName = "Config"
    },
    Discord = { Enabled = false }
})

-- ===== Variables =====
local selectedGun = nil

-- ===== Functions =====
local function getGunList()
    local gunFolder = workspace:FindFirstChild("GUNS")
    if not gunFolder then return {} end
    local guns = {}
    for _, gun in pairs(gunFolder:GetChildren()) do
        table.insert(guns, gun.Name)
    end
    return guns
end

local function F9Notification(text)
    Rayfield:Notify({
        Title = "Quick Buy",
        Content = text,
        Duration = 3,
        Image = 4483362458,
        Actions = {}
    })
end

-- Purchase using ProximityPrompt (if exists)
local function purchaseGunPrompt(gunName)
    local gunObj = workspace:FindFirstChild("GUNS") and workspace.GUNS:FindFirstChild(gunName)
    if not gunObj then
        F9Notification("‚ùå Gun not found in GUNS folder")
        return false
    end

    local prompt = gunObj:FindFirstChildOfClass("ProximityPrompt")
    if not prompt then
        F9Notification("‚ùå No ProximityPrompt found for this gun")
        return false
    end

    local success, err = pcall(function()
        prompt:InputHoldBegin()
        task.wait(0.1) -- small wait for prompt
        prompt:InputHoldEnd()
    end)

    if success then
        F9Notification("‚úÖ Purchased: " .. gunName)
    else
        F9Notification("‚ùå Purchase Failed: " .. tostring(err))
    end

    return success
end

-- Auto purchase function
local function autoPurchaseGun()
    if not selectedGun then
        F9Notification("‚ùå Please select a gun first")
        return
    end
    purchaseGunPrompt(selectedGun)
end

-- ===== UI =====
local QuickBuyTab = Window:CreateTab("Quick Buy", 4483362458)

-- Selected gun label
local SelectedLabel = QuickBuyTab:CreateLabel("Selected: None")

-- Dropdown for selecting gun
local GunDropdown = QuickBuyTab:CreateDropdown({
    Name = "Select Gun",
    Options = getGunList(),
    CurrentOption = "",
    Flag = "GunDropdown",
    Callback = function(option)
        selectedGun = option
        SelectedLabel:Set("Selected: " .. option)
    end
})

-- Purchase button (fires ProximityPrompt)
QuickBuyTab:CreateButton({
    Name = "üöÄ Purchase Selected Gun",
    Callback = function()
        autoPurchaseGun()
    end
})

-- Refresh dropdown button
QuickBuyTab:CreateButton({
    Name = "üîÑ Refresh Gun List",
    Callback = function()
        local guns = getGunList()
        GunDropdown:UpdateOptions(guns)
        if #guns > 0 then
            F9Notification("‚úÖ Found " .. #guns .. " guns. Select one.")
        else
            F9Notification("‚ùå No guns found in GUNS folder.")
        end
        selectedGun = nil
        SelectedLabel:Set("Selected: None")
    end
})
