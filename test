local Old; Old = hookfunction(getrenv().tick, function(...)
    local Response = Old(...)
    if not checkcaller() and tostring(getcallingscript()):find("?") then
        Response = Old
        return coroutine.yield()
    end
    return Response
end)

task.wait(1)

local Old; Old = hookfunction(gcinfo, function(...)
    local Response = Old(...)
    if tostring(getcallingscript()):find("?") then
        return Response + math.random(0, 1e4)
    end
    return Response
end)

for Index, Value in getconnections(cloneref(game:GetService("ScriptContext")).Error) do
    Value:Disable()
end

task.spawn(function()
    local Players = cloneref(game:GetService("Players"))
    local Data = {}
    local Sizes = {}

    if not Players.LocalPlayer.Character then
        Players.LocalPlayer.CharacterAdded:Wait()
        task.wait(1)
    end

    for Index, Value in Players.LocalPlayer.Character:GetDescendants() do
        pcall(function()
            Data[tostring(Value)] = Value.CanCollide
        end)
    end

    local Old; Old = hookmetamethod(game, "__index", function(...)
        local Self, Index = ...

        if checkcaller() then
            return Old(...)
        end

        if tostring(Self) == "Humanoid" and Index == "WalkSpeed" then
            return 10
        end

        if Data[tostring(Self)] ~= nil and Index == "CanCollide" then
            return Data[tostring(Self)]
        end

        return Old(...)
    end)
end)

getgenv().AntiCheatBypass = true

repeat task.wait() until getgenv().AntiCheatBypass

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local customTheme = {
    TextColor = Color3.fromRGB(255, 255, 255),
    Background = Color3.fromRGB(15, 15, 15),
    Topbar = Color3.fromRGB(15, 15, 15),
    Shadow = Color3.fromRGB(255, 255, 255),
    NotificationBackground = Color3.fromRGB(0, 0, 0),
    NotificationActionsBackground = Color3.fromRGB(35, 0, 70),
    TabBackground = Color3.fromRGB(15, 15, 15),
    TabStroke = Color3.fromRGB(15, 15, 15),
    TabBackgroundSelected = Color3.fromRGB(15, 15, 15),
    TabTextColor = Color3.fromRGB(149, 149, 149),
    SelectedTabTextColor = Color3.fromRGB(255, 255, 255),
    ElementBackground = Color3.fromRGB(15, 15, 15),
    ElementBackgroundHover = Color3.fromRGB(15, 15, 15),
    SecondaryElementBackground = Color3.fromRGB(15, 15, 15),
    ElementStroke = Color3.fromRGB(77, 251, 16),
    SecondaryElementStroke = Color3.fromRGB(77, 251, 16),
    SliderBackground = Color3.fromRGB(255, 255, 255),
    SliderProgress = Color3.fromRGB(77, 251, 16),
    SliderStroke = Color3.fromRGB(77, 251, 16),
    ToggleBackground = Color3.fromRGB(15, 15, 15),
    ToggleEnabled = Color3.fromRGB(77, 251, 16),
    ToggleDisabled = Color3.fromRGB(255, 255, 255),
    ToggleEnabledStroke = Color3.fromRGB(77, 251, 16),
    ToggleDisabledStroke = Color3.fromRGB(15, 15, 15),
    ToggleEnabledOuterStroke = Color3.fromRGB(255, 255, 255),
    ToggleDisabledOuterStroke = Color3.fromRGB(255, 255, 255),
    DropdownSelected = Color3.fromRGB(15, 15, 15),
    DropdownUnselected = Color3.fromRGB(15, 15, 15),
    InputBackground = Color3.fromRGB(15, 15, 15),
    InputStroke = Color3.fromRGB(77, 251, 16),
}

local Window = Rayfield:CreateWindow({
    Name = "DK's Hub V1 | South bronx | Premium",
    Icon = 112029241653427,
    LoadingTitle = "",
    LoadingSubtitle = "",
    Theme = customTheme,
    DisableRayfieldPrompts = false,
    DisableBuildWarnings = false,
    ConfigurationSaving = {
        Enabled = false,
        FolderName = "GreenBlackThemeHub",
        FileName = "BigHub"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "",
        Subtitle = "Authentication Required",
        Note = "Get your key at: discord.gg/dkshub",
        FileName = "jc_hub_key",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = { "" },
        Theme = customTheme
    }
})

local GeneralTab = Window:CreateTab("General", "box")
GeneralTab:CreateSection("Farming - Chips Settings")

local amountToBuy = 1

GeneralTab:CreateInput({
    Name = "Chips Amount",
    PlaceholderText = "Input",
    RemoveTextAfterFocusLost = false,
    Callback = function(Value)
        amountToBuy = tonumber(Value) or 1
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local humanoid = char:WaitForChild("Humanoid")
        local hrp = char:WaitForChild("HumanoidRootPart")
        local targetPos = Vector3.new(-771, 4, -198)
        local storeRemote = game:GetService("ReplicatedStorage"):WaitForChild("RemoteEvents"):WaitForChild("StorePurchase")

        while (hrp.Position - targetPos).Magnitude > 2 do
            humanoid:MoveTo(targetPos)
            task.wait(0.1)
        end

        for i = 1, amountToBuy do
            storeRemote:FireServer("Flour")
            storeRemote:FireServer("Potato")
            task.wait(0.1)
        end
    end
})

GeneralTab:CreateSection("Farming - Negros")

local ChipsAutofarmToggle = GeneralTab:CreateToggle({
    Name = "Enable Chips Autofarm",
    CurrentValue = false,
    Flag = "ChipsAutofarm",
    Callback = function(Value)
        local running = Value
        task.spawn(function()
            local positions = {
                {pos = Vector3.new(-461.62, 3.86, -467.55), tool = "Potato", holdE = true, holdTime = 0, waitTime = 2},
                {pos = Vector3.new(-461.6, 3.86, -473.63), holdE = true, holdTime = 0, waitTime = 2},
                {pos = Vector3.new(-466.43, 3.96, -500.60)},
                {pos = Vector3.new(-462.67, 3.86, -522.34), tool = "Flour", holdE = true, holdTime = 0, waitTime = 2},
                {pos = Vector3.new(-468.11, 3.86, -494.76)},
                {pos = Vector3.new(-515.34, 3.86, -482.29), holdE = true, holdTime = 0, waitTime = 65, reholdE = true, reholdTime = 0},
                {pos = Vector3.new(-492, 4, -473)}, 
                {pos = Vector3.new(-480, 4, -434), holdE = true, holdTime = 0}
            }

            local player = game.Players.LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
            local humanoid = character:WaitForChild("Humanoid")
            humanoid.WalkSpeed = 19

            local function moveTo(targetPos)
                while (humanoidRootPart.Position - targetPos).Magnitude > 2 do
                    if not running then return end
                    humanoid:MoveTo(targetPos)
                    task.wait(0.1)
                end
            end

            local function performAction(action)
                if not running then return end
                if action.tool then
                    local tool = player.Backpack:FindFirstChild(action.tool)
                    if tool then
                        tool.Parent = character
                    end
                end
                if action.holdE then
                    game:GetService("VirtualInputManager"):SendKeyEvent(true, Enum.KeyCode.E, false, game)
                    wait(action.holdTime)
                    game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.E, false, game)
                end
                if action.waitTime then
                    wait(action.waitTime)
                end
            end

            for _, v in pairs(game:GetService("Workspace"):GetDescendants()) do
                if v:IsA("ProximityPrompt") then
                    v.HoldDuration = 0
                end
            end

            game:GetService("ProximityPromptService").PromptButtonHoldBegan:Connect(function(v)
                v.HoldDuration = 0
            end)

            while running do
                for _, action in ipairs(positions) do
                    if not running then break end
                    moveTo(action.pos)
                    performAction(action)
                    if action.reholdE then
                        performAction({holdE = true, holdTime = action.reholdTime})
                    end
                end
            end
        end)
    end,
})


local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")
local camera = Workspace.CurrentCamera

local Map = Workspace:FindFirstChild("Map")
local RoadsFolder = Map and Map:FindFirstChild("Roads/Sidewalks")
local opp, noclipEnabled = {}, false
local running = false

local function setHiddenProperty(i, p, v)
    pcall(function()
        sethiddenproperty(i, p, v)
    end)
end

local function shouldExclude(part)
    local partName = part.Name:lower()
    local isUnderPlayer = (part.Position.Y < hrp.Position.Y - 2)

    return
        (RoadsFolder and part:IsDescendantOf(RoadsFolder))
        or part:IsDescendantOf(character)
        or part:IsA("VehicleSeat") or part:IsA("Vehicle")
        or partName:find("floor") or partName:find("ground") or partName:find("sidewalk")
        or isUnderPlayer
        or (part.Parent and part.Parent:IsA("Model") and Players:GetPlayerFromCharacter(part.Parent) ~= nil)
end

local function applyNoclip()
    local pos = camera.CFrame.Position
    local region = Region3.new(pos - Vector3.new(15, 15, 15), pos + Vector3.new(15, 15, 15))
    for _, part in ipairs(Workspace:FindPartsInRegion3(region, nil, math.huge)) do
        if part:IsA("BasePart") and not shouldExclude(part) and not opp[part] then
            opp[part] = { CanCollide = part.CanCollide }
            setHiddenProperty(part, "CanCollide", false)
        end
    end
end

local function resetNoclip()
    for part, original in pairs(opp) do
        if part:IsA("BasePart") then
            setHiddenProperty(part, "CanCollide", original.CanCollide)
        end
    end
    opp = {}
end

local function walkToNoClip(pos, stopDist)
    stopDist = stopDist or 3
    noclipEnabled = true

    task.spawn(function()
        while noclipEnabled do
            applyNoclip()
            task.wait(0.1)
        end
    end)

    humanoid:MoveTo(pos)
    while (hrp.Position - pos).Magnitude > stopDist and running do
        task.wait()
        humanoid:MoveTo(pos)
    end

    noclipEnabled = false
    resetNoclip()
end

local function equipTool(toolName)
    local tool = player.Backpack:FindFirstChild(toolName)
    if tool then
        tool.Parent = character
    else
        warn("â "..toolName.." not found in backpack.")
    end
end

GeneralTab:CreateToggle({
    Name = "Enable ATM Autofarm",
    CurrentValue = false,
    Flag = "AutoWalkToggle",
    Callback = function(state)
        running = state
        if state then
            task.spawn(function()
                walkToNoClip(Vector3.new(217, 4, -332))
                if not running then return end

                local idPrompt = Workspace.Folders.NPCs.FakeIDSeller.UpperTorso.Attachment:FindFirstChildWhichIsA("ProximityPrompt")
                if idPrompt then
                    fireproximityprompt(idPrompt, 1)
                    task.wait(0.5)
                else
                    warn("â Fake ID Seller prompt not found.")
                    running = false
                    return
                end

                equipTool("Fake ID")
                if not running then return end

                walkToNoClip(Vector3.new(-49, 4, -321))
                if not running then return end

                local tellerModel = Workspace.Folders.NPCs:FindFirstChild("Bank Teller")
                if tellerModel then
                    local tellerPrompt = tellerModel.UpperTorso.Attachment:FindFirstChildWhichIsA("ProximityPrompt")
                    if tellerPrompt then
                        fireproximityprompt(tellerPrompt, 1)
                        task.wait(0.5)
                    else
                        warn("â Bank Teller prompt not found.")
                        running = false
                        return
                    end
                else
                    warn("â Bank Teller NPC not found.")
                    running = false
                    return
                end

                walkToNoClip(Vector3.new(-43, 3, -328))
                if not running then return end

                task.wait(45)
                if not running then return end

                local cardPickupPrompt = Workspace.CardPickup.Attachment:FindFirstChildWhichIsA("ProximityPrompt")
                if cardPickupPrompt then
                    fireproximityprompt(cardPickupPrompt, 1)
                    task.wait(0.5)
                    equipTool("Card")
                else
                    warn("â CardPickup prompt not found.")
                    running = false
                    return
                end
                if not running then return end

                walkToNoClip(Vector3.new(-651, 4, 155))
                if not running then return end

                local atmPrompt = Workspace.Map.ATMS.ATM11.Attachment:FindFirstChildWhichIsA("ProximityPrompt")
                if atmPrompt then
                    fireproximityprompt(atmPrompt, 1)
                else
                    warn("â ATM11 prompt not found.")
                end

                running = false
            end)
        else
            running = false
            resetNoclip()
            humanoid:MoveTo(hrp.Position)
        end
    end,
})


local autofarmRunning = false
local autofarmThread = nil

local Toggle = GeneralTab:CreateToggle({
    Name = "Enable Box Autofarm",
    CurrentValue = false,
    Flag = "BoxAutofarm",
    Callback = function(state)
        autofarmRunning = state
        if state then
            startAutofarm()
        end
    end
})

function startAutofarm()
    if autofarmThread then return end
    autofarmThread = coroutine.create(function()
        local player = game.Players.LocalPlayer

        while autofarmRunning do
            local character = player.Character or player.CharacterAdded:Wait()
            local humanoid = character:FindFirstChild("Humanoid") or character:WaitForChild("Humanoid")
            local hrp = character:FindFirstChild("HumanoidRootPart") or character:WaitForChild("HumanoidRootPart")
            local backpack = player:WaitForChild("Backpack")

            local konum1 = Vector3.new(-551.46, 3.54, -86.13)
            local konum2 = Vector3.new(-540.16, 3.54, -83.06)
            local konum3 = Vector3.new(-401.42, 3.36, -70.90)

            local function firePrompt(prompt)
                if prompt and prompt:IsA("ProximityPrompt") then
                    fireproximityprompt(prompt)
                end
            end

            local function moveToPosition(position)
                humanoid.WalkSpeed = 15
                local arrived = false
                local connection = humanoid.MoveToFinished:Connect(function(reached)
                    arrived = reached
                end)

                while autofarmRunning and not arrived and (hrp.Position - position).Magnitude > 3 do
                    humanoid:MoveTo(position)
                    task.wait(0.25)
                end

                if connection then connection:Disconnect() end
                humanoid.WalkSpeed = 80
            end

            local function getCrateFromBackpack()
                for _, item in ipairs(backpack:GetChildren()) do
                    if item.Name == "Crate" then
                        return item
                    end
                end
                return nil
            end

            local function equipCrate(crate)
                if crate then
                    crate.Parent = character
                    local hand = character:FindFirstChild("RightHand") or character:WaitForChild("RightHand")
                    if crate:FindFirstChild("Handle") and hand then
                        crate.Handle.CFrame = hand.CFrame
                    end
                end
            end

            local function performAction()
                if not autofarmRunning then return end

                moveToPosition(konum1)
                if not autofarmRunning then return end

                local pickupPrompt = workspace.PlaceHere
                    and workspace.PlaceHere:FindFirstChild("Attachment")
                    and workspace.PlaceHere.Attachment:FindFirstChildOfClass("ProximityPrompt")

                firePrompt(pickupPrompt)
                task.wait(0.5)

                local crate
                repeat
                    crate = getCrateFromBackpack()
                    task.wait(0.1)
                until not autofarmRunning or crate

                if not autofarmRunning or not crate then return end
                equipCrate(crate)
                task.wait(0.3)

                moveToPosition(konum2)
                if not autofarmRunning then return end

                moveToPosition(konum3)
                if not autofarmRunning then return end

                local dropoffPrompt = workspace.cratetruck2
                    and workspace.cratetruck2:FindFirstChild("Model")
                    and workspace.cratetruck2.Model:FindFirstChild("ClickBox")
                    and workspace.cratetruck2.Model.ClickBox:FindFirstChild("Attachment")
                    and workspace.cratetruck2.Model.ClickBox.Attachment:FindFirstChildOfClass("ProximityPrompt")

                firePrompt(dropoffPrompt)
                task.wait(0.5)

                moveToPosition(konum2)
                moveToPosition(konum1)
            end

            while autofarmRunning and player.Character and player.Character:FindFirstChild("Humanoid") do
                performAction()
                task.wait(1)
            end

            if autofarmRunning then
                player.CharacterAdded:Wait()
            end
        end

        autofarmThread = nil
    end)

    coroutine.resume(autofarmThread)
end

GeneralTab:CreateSection("Farming - Settings")

local NoclipConnection = nil
local Clip = true

local function noclip()
    Clip = false
    local function Nocl()
        if not Clip and game.Players.LocalPlayer.Character then
            for _, v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") and v.CanCollide then
                    v.CanCollide = false
                end
            end
        end
        task.wait(0.21)
    end
    NoclipConnection = game:GetService("RunService").Stepped:Connect(Nocl)
end

local function clip()
    if NoclipConnection then
        NoclipConnection:Disconnect()
    end
    Clip = true
end

GeneralTab:CreateToggle({
    Name = "Enable No-Clip",
    CurrentValue = false,
    Callback = function(Value)
        if Value then
            noclip()
        else
            clip()
        end
    end
})
