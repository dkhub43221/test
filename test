local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Gun Purchaser",
    LoadingTitle = "Gun Purchaser",
    LoadingSubtitle = "by YourName",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "GunPurchaserConfig",
        FileName = "UserConfig"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    }
})

local GeneralTab = Window:CreateTab("General", 4483362458)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local function getGunList()
    local guns = {}
    local folder = workspace:FindFirstChild("GUNS") or ReplicatedStorage:FindFirstChild("GUNS")
    if not folder then return guns end

    for _, gun in ipairs(folder:GetChildren()) do
        if gun:IsA("Model") or gun:IsA("BasePart") then
            table.insert(guns, gun.Name)
        end
    end

    return guns
end

local function FirePrompt(prompt)
    if typeof(fireproximityprompt) == "function" then
        fireproximityprompt(prompt)
    else
        prompt:InputHoldBegin()
        task.wait(prompt.HoldDuration or 0)
        prompt:InputHoldEnd()
    end
end

local selectedGun

GeneralTab:CreateDropdown({
    Name = "Select Gun",
    Options = getGunList(),
    CurrentOption = {},
    Callback = function(option)
        selectedGun = option[1]
    end
})

GeneralTab:CreateButton({
    Name = "Buy Selected Gun",
    Callback = function()
        if not selectedGun then
            Rayfield:Notify({
                Title = "Error",
                Content = "Select a gun first",
                Duration = 2
            })
            return
        end

        local player = LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local humanoid = char:WaitForChild("Humanoid")
        local hrp = char:WaitForChild("HumanoidRootPart")

        local folder = workspace:FindFirstChild("GUNS") or ReplicatedStorage:FindFirstChild("GUNS")
        if not folder then
            Rayfield:Notify({
                Title = "Failed",
                Content = "Gun folder not found",
                Duration = 2
            })
            return
        end

        local gun = folder:FindFirstChild(selectedGun)
        if not gun then
            Rayfield:Notify({
                Title = "Failed",
                Content = "Gun not found",
                Duration = 2
            })
            return
        end

        humanoid:ChangeState(0)
        repeat task.wait() until not player:GetAttribute("LastACPos")

        local targetPart
        if gun:IsA("Model") then
            targetPart = gun.PrimaryPart or gun:FindFirstChildWhichIsA("BasePart", true)
        elseif gun:IsA("BasePart") then
            targetPart = gun
        end

        if not targetPart then
            Rayfield:Notify({
                Title = "Failed",
                Content = "Cannot find part to TP to",
                Duration = 2
            })
            return
        end

        hrp.CFrame = targetPart.CFrame * CFrame.new(0, 0, -2)
        task.wait(0.25)

        local prompt = gun:FindFirstChildWhichIsA("ProximityPrompt", true)
        if prompt then
            FirePrompt(prompt)
            Rayfield:Notify({
                Title = "Success",
                Content = "Bought " .. selectedGun,
                Duration = 2
            })
        else
            Rayfield:Notify({
                Title = "Failed",
                Content = "ProximityPrompt not found",
                Duration = 2
            })
        end
    end
})
